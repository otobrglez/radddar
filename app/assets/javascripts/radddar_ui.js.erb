/* By Oto Brglez - <oto.brglez@opalab.com> */

$(function(){

	/* Handle ajax errors */
	$("#global_error").ajaxError(function(event,request,settings){
		if(!$(this).is("visible"))
			$(this).fadeIn("slow");
	});

	// Status form
	$("#app .profile_header").radddar_status();
	
	// Get current user and establish private channel
	CurrentUser.current_user(function(data){
		var settings = {
			app_id:'<%= PUSHER["app_id"] %>',
			key:'<%= PUSHER["key"] %>',
			secret:'<%= PUSHER["secret"] %>',
			user: data			
		}
		var radddar_pusher = $("#app").radddar_pusher(settings);
	});
	
	// Load navigation
	$("#app").radddar_navigation();

	// Selector buttons for profile form
	$("#app .selector").radddar_selector();

	$("#app").radddar_chat();
	
	// Map magic
	$("#map").radddar_map_engine();
	// $("#map").hide();

});